"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[155],{189:function(e,t,n){n.d(t,{E6:function(){return m},Kb:function(){return E},LR:function(){return f},NH:function(){return c},PQ:function(){return N},S5:function(){return d},Vi:function(){return y},Y7:function(){return b},Zf:function(){return S},cl:function(){return l},f_:function(){return s},g6:function(){return v},hT:function(){return R},qQ:function(){return p}});var r=n(1988),o=n(7930),i=n(5969),a=n(5118),u=n(8144);function s(){let e=(0,u.t)(e=>e.currentSiteId);return(0,r.a)({queryKey:["dashboard","stats",e],queryFn:()=>(0,a.S)("/sites/".concat(e,"/stats")),enabled:!!e})}function c(e){let t=(0,u.t)(e=>e.currentSiteId),n=new URLSearchParams;return t&&n.set("siteId",t),e&&n.set("status",e),(0,r.a)({queryKey:["admin","posts",t,e],queryFn:()=>(0,a.S)("/posts?".concat(n.toString())),enabled:!!t})}function d(e){return(0,r.a)({queryKey:["admin","post",e],queryFn:()=>(0,a.S)("/posts/".concat(e)),enabled:!!e})}function l(){let e=(0,o.NL)();return(0,i.D)({mutationFn:e=>{let{postId:t,action:n,reason:r,note:o}=e;return(0,a.S)("/reviews",{method:"POST",body:JSON.stringify({postId:t,action:n,reason:r,note:o})})},onSuccess:()=>{e.invalidateQueries({queryKey:["admin","posts"]}),e.invalidateQueries({queryKey:["dashboard"]})}})}function f(){let e=(0,u.t)(e=>e.currentSiteId);return(0,r.a)({queryKey:["admin","members",e],queryFn:()=>(0,a.S)("/sites/".concat(e,"/members")),enabled:!!e})}function E(e){let t=(0,u.t)(e=>e.currentSiteId);return(0,r.a)({queryKey:["admin","member",t,e],queryFn:()=>(0,a.S)("/sites/".concat(t,"/members/").concat(e)),enabled:!!t&&!!e})}function m(){let e=(0,u.t)(e=>e.currentSiteId);return(0,r.a)({queryKey:["admin","points",e],queryFn:()=>(0,a.S)("/points/history?siteId=".concat(e)),enabled:!!e})}function y(){let e=(0,o.NL)(),t=(0,u.t)(e=>e.currentSiteId);return(0,i.D)({mutationFn:e=>{let{memberId:n,amount:r,reason:o}=e;return(0,a.S)("/points/award",{method:"POST",body:JSON.stringify({siteId:t,memberId:n,amount:r,reason:o})})},onSuccess:()=>{e.invalidateQueries({queryKey:["admin","points"]}),e.invalidateQueries({queryKey:["admin","members"]})}})}function b(){let e=(0,u.t)(e=>e.currentSiteId);return(0,r.a)({queryKey:["admin","announcements",e],queryFn:()=>(0,a.S)("/announcements?siteId=".concat(e)),enabled:!!e})}function p(){let e=(0,o.NL)(),t=(0,u.t)(e=>e.currentSiteId);return(0,i.D)({mutationFn:e=>{let{title:n,content:r,isPinned:o}=e;return(0,a.S)("/announcements",{method:"POST",body:JSON.stringify({siteId:t,title:n,content:r,isPinned:o})})},onSuccess:()=>{e.invalidateQueries({queryKey:["admin","announcements"]})}})}function N(){let e=(0,o.NL)();return(0,i.D)({mutationFn:e=>{let{id:t,title:n,content:r,isPinned:o}=e;return(0,a.S)("/announcements/".concat(t),{method:"PUT",body:JSON.stringify({title:n,content:r,isPinned:o})})},onSuccess:()=>{e.invalidateQueries({queryKey:["admin","announcements"]})}})}function S(){let e=(0,o.NL)();return(0,i.D)({mutationFn:e=>(0,a.S)("/announcements/".concat(e),{method:"DELETE"}),onSuccess:()=>{e.invalidateQueries({queryKey:["admin","announcements"]})}})}function R(){let e=(0,u.t)(e=>e.currentSiteId);return(0,r.a)({queryKey:["admin","audit",e],queryFn:()=>Promise.resolve([]),enabled:!!e})}function v(){let e=(0,u.t)(e=>e.currentSiteId);return(0,r.a)({queryKey:["admin","actions",e],queryFn:()=>(0,a.S)("/actions?siteId=".concat(e)),enabled:!!e})}},5118:function(e,t,n){n.d(t,{S:function(){return a}});var r=n(8144);let o="https://api.safework2.jclee.me";class i extends Error{constructor(e,t,n){super(e),this.status=t,this.code=n,this.name="ApiError"}}async function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{tokens:n,logout:a,setTokens:u}=r.t.getState(),s={"Content-Type":"application/json",...t.headers||{}};(null==n?void 0:n.accessToken)&&(s.Authorization="Bearer ".concat(n.accessToken));let c=await fetch("".concat(o).concat(e),{...t,headers:s});if(401===c.status&&(null==n?void 0:n.refreshToken)){let r=await fetch("".concat(o,"/auth/refresh"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:n.refreshToken})});if(r.ok){let n=await r.json();u(n),s.Authorization="Bearer ".concat(n.accessToken),c=await fetch("".concat(o).concat(e),{...t,headers:s})}else throw a(),new i("Session expired",401,"SESSION_EXPIRED")}if(!c.ok){let e=await c.json().catch(()=>({}));throw new i(e.message||"Request failed",c.status,e.code)}return c.json()}},8144:function(e,t,n){n.d(t,{t:function(){return a}});var r=n(8321),o=n(4452),i=n(3212);let a=(0,r.U)()((0,o.tJ)((e,t)=>({user:null,tokens:null,currentSiteId:null,isAdmin:!1,login:(t,n)=>e({user:t,tokens:n,isAdmin:t.role===i.UserRole.SITE_ADMIN||t.role===i.UserRole.SUPER_ADMIN}),logout:()=>e({user:null,tokens:null,currentSiteId:null,isAdmin:!1}),setTokens:t=>e({tokens:t}),setSiteId:t=>e({currentSiteId:t})}),{name:"safetywallet-admin-auth"}))},5363:function(e,t){Object.defineProperty(t,"__esModule",{value:!0})},8658:function(e,t){Object.defineProperty(t,"__esModule",{value:!0})},8536:function(e,t){Object.defineProperty(t,"__esModule",{value:!0})},4602:function(e,t){Object.defineProperty(t,"__esModule",{value:!0})},6183:function(e,t,n){var r=Object.create?function(e,t,n,r){void 0===r&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);(!o||("get"in o?!t.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]},o=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),o(n(4602),t),o(n(3700),t),o(n(6668),t),o(n(5769),t),o(n(2232),t),o(n(1098),t),o(n(8658),t),o(n(8536),t)},1098:function(e,t){Object.defineProperty(t,"__esModule",{value:!0})},5769:function(e,t){Object.defineProperty(t,"__esModule",{value:!0})},2232:function(e,t){Object.defineProperty(t,"__esModule",{value:!0})},6668:function(e,t){Object.defineProperty(t,"__esModule",{value:!0})},3700:function(e,t){Object.defineProperty(t,"__esModule",{value:!0})},9633:function(e,t){var n,r,o,i,a,u,s,c,d,l,f,E,m,y,b,p,N,S,R,v;Object.defineProperty(t,"__esModule",{value:!0}),t.RejectReason=t.TaskStatus=t.ReviewAction=t.ActionStatus=t.ReviewStatus=t.Visibility=t.RiskLevel=t.Category=t.MembershipStatus=t.UserRole=void 0,(f=n||(t.UserRole=n={})).WORKER="WORKER",f.SITE_ADMIN="SITE_ADMIN",f.SUPER_ADMIN="SUPER_ADMIN",f.SYSTEM="SYSTEM",(E=r||(t.MembershipStatus=r={})).PENDING="PENDING",E.ACTIVE="ACTIVE",E.LEFT="LEFT",E.REMOVED="REMOVED",(m=o||(t.Category=o={})).HAZARD="HAZARD",m.UNSAFE_BEHAVIOR="UNSAFE_BEHAVIOR",m.INCONVENIENCE="INCONVENIENCE",m.SUGGESTION="SUGGESTION",m.BEST_PRACTICE="BEST_PRACTICE",(y=i||(t.RiskLevel=i={})).HIGH="HIGH",y.MEDIUM="MEDIUM",y.LOW="LOW",(b=a||(t.Visibility=a={})).WORKER_PUBLIC="WORKER_PUBLIC",b.ADMIN_ONLY="ADMIN_ONLY",(p=u||(t.ReviewStatus=u={})).RECEIVED="RECEIVED",p.IN_REVIEW="IN_REVIEW",p.NEED_INFO="NEED_INFO",p.APPROVED="APPROVED",p.REJECTED="REJECTED",(N=s||(t.ActionStatus=s={})).NONE="NONE",N.REQUIRED="REQUIRED",N.ASSIGNED="ASSIGNED",N.IN_PROGRESS="IN_PROGRESS",N.DONE="DONE",N.REOPENED="REOPENED",(S=c||(t.ReviewAction=c={})).APPROVE="APPROVE",S.REJECT="REJECT",S.REQUEST_MORE="REQUEST_MORE",S.MARK_URGENT="MARK_URGENT",S.ASSIGN="ASSIGN",S.CLOSE="CLOSE",(R=d||(t.TaskStatus=d={})).OPEN="OPEN",R.IN_PROGRESS="IN_PROGRESS",R.DONE="DONE",(v=l||(t.RejectReason=l={})).DUPLICATE="DUPLICATE",v.UNCLEAR_PHOTO="UNCLEAR_PHOTO",v.INSUFFICIENT="INSUFFICIENT",v.FALSE="FALSE",v.IRRELEVANT="IRRELEVANT",v.OTHER="OTHER"},3212:function(e,t,n){var r=Object.create?function(e,t,n,r){void 0===r&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);(!o||("get"in o?!t.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]},o=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),o(n(9633),t),o(n(5363),t),o(n(6183),t)},2384:function(e,t,n){n.d(t,{Ct:function(){return m},zx:function(){return d},Zb:function(){return l},II:function(){return f},Od:function(){return y},cn:function(){return i}});var r=n(607),o=n(5579);function i(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,o.m6)((0,r.W)(t))}var a=n(7573),u=n(7653),s=n(9289);let c=(0,s.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=u.forwardRef((e,t)=>{let{className:n,variant:r,size:o,...u}=e;return(0,a.jsx)("button",{className:i(c({variant:r,size:o,className:n})),ref:t,...u})});d.displayName="Button";let l=u.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,a.jsx)("div",{ref:t,className:i("rounded-lg border bg-card text-card-foreground shadow-sm",n),...r})});l.displayName="Card",u.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,a.jsx)("div",{ref:t,className:i("flex flex-col space-y-1.5 p-6",n),...r})}).displayName="CardHeader",u.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,a.jsx)("h3",{ref:t,className:i("text-2xl font-semibold leading-none tracking-tight",n),...r})}).displayName="CardTitle",u.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,a.jsx)("p",{ref:t,className:i("text-sm text-muted-foreground",n),...r})}).displayName="CardDescription",u.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,a.jsx)("div",{ref:t,className:i("p-6 pt-0",n),...r})}).displayName="CardContent",u.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,a.jsx)("div",{ref:t,className:i("flex items-center p-6 pt-0",n),...r})}).displayName="CardFooter";let f=u.forwardRef((e,t)=>{let{className:n,type:r,...o}=e;return(0,a.jsx)("input",{type:r,className:i("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",n),ref:t,...o})});f.displayName="Input";let E=(0,s.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground",secondary:"border-transparent bg-secondary text-secondary-foreground",destructive:"border-transparent bg-destructive text-destructive-foreground",outline:"text-foreground",success:"border-transparent bg-success text-success-foreground",warning:"border-transparent bg-warning text-warning-foreground",info:"border-transparent bg-blue-500 text-white",neutral:"border-transparent bg-gray-500 text-white"}},defaultVariants:{variant:"default"}});function m(e){let{className:t,variant:n,...r}=e;return(0,a.jsx)("div",{className:i(E({variant:n}),t),...r})}function y(e){let{className:t,...n}=e;return(0,a.jsx)("div",{className:i("animate-pulse rounded-md bg-muted",t),...n})}u.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,a.jsx)("span",{ref:t,className:i("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",n),...r})}).displayName="Avatar",u.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,a.jsx)("img",{ref:t,className:i("aspect-square h-full w-full",n),...r})}).displayName="AvatarImage",u.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,a.jsx)("span",{ref:t,className:i("flex h-full w-full items-center justify-center rounded-full bg-muted",n),...r})}).displayName="AvatarFallback"}}]);