(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[626],{6495:function(e,t,r){Promise.resolve().then(r.bind(r,5024))},5024:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return u}});var n=r(7573),a=r(7653),s=r(1695),o=r(2384),i=r(8368),l=r(5118);function u(){let e=(0,s.useRouter)(),{login:t}=(0,i.a)(),[r,u]=(0,a.useState)(""),[c,d]=(0,a.useState)(""),[f,m]=(0,a.useState)(""),[g,h]=(0,a.useState)(""),[p,x]=(0,a.useState)(!1),b=async n=>{n.preventDefault(),h(""),x(!0);try{let{accessToken:n,refreshToken:a,user:s}=(await (0,l.S)("/auth/login",{method:"POST",body:JSON.stringify({name:r.trim(),phone:c.replace(/[^0-9]/g,""),dob:f.replace(/[^0-9]/g,"")}),skipAuth:!0})).data;t(s,n,a),e.replace("/join")}catch(e){e instanceof Error?h(e.message||"로그인에 실패했습니다."):h("등록되지 않은 사용자입니다. 현장 관리자에게 문의하세요.")}finally{x(!1)}},v=r.trim().length>0&&c.replace(/[^0-9]/g,"").length>=10&&6===f.replace(/[^0-9]/g,"").length;return(0,n.jsx)("div",{className:"flex items-center justify-center min-h-screen p-4 bg-gray-50",children:(0,n.jsxs)(o.Zb,{className:"w-full max-w-sm",children:[(0,n.jsxs)(o.Ol,{className:"text-center",children:[(0,n.jsx)(o.ll,{className:"text-2xl",children:"안전지갑"}),(0,n.jsx)(o.SZ,{children:"본인 확인을 위해 정보를 입력하세요"})]}),(0,n.jsx)(o.aY,{children:(0,n.jsxs)("form",{onSubmit:b,className:"space-y-4",children:[(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("label",{htmlFor:"name",className:"text-sm font-medium",children:"이름"}),(0,n.jsx)(o.II,{id:"name",type:"text",placeholder:"홍길동",value:r,onChange:e=>u(e.target.value),disabled:p,autoComplete:"name"})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("label",{htmlFor:"phone",className:"text-sm font-medium",children:"휴대폰 번호"}),(0,n.jsx)(o.II,{id:"phone",type:"tel",placeholder:"010-0000-0000",value:c,onChange:e=>d(e.target.value),disabled:p,autoComplete:"tel"})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("label",{htmlFor:"dob",className:"text-sm font-medium",children:"생년월일 (6자리)"}),(0,n.jsx)(o.II,{id:"dob",type:"text",inputMode:"numeric",placeholder:"YYMMDD (예: 850101)",value:f,onChange:e=>m(e.target.value.replace(/[^0-9]/g,"").slice(0,6)),disabled:p,maxLength:6})]}),g&&(0,n.jsx)("p",{className:"text-sm text-destructive text-center",children:g}),(0,n.jsx)(o.zx,{type:"submit",className:"w-full",disabled:p||!v,children:p?"확인 중...":"로그인"}),(0,n.jsxs)("p",{className:"text-xs text-muted-foreground text-center mt-4",children:["FAS 안면인식 시스템에 등록된 정보로 로그인합니다.",(0,n.jsx)("br",{}),"등록되지 않은 경우 현장 관리자에게 문의하세요."]})]})})]})})}},8368:function(e,t,r){"use strict";r.d(t,{a:function(){return a}});var n=r(8144);function a(){let{user:e,isAuthenticated:t,currentSiteId:r,login:a,logout:s,setCurrentSite:o}=(0,n.t)();return{user:e,isAuthenticated:t,currentSiteId:r,login:a,logout:s,setCurrentSite:o}}},5118:function(e,t,r){"use strict";r.d(t,{S:function(){return s}});var n=r(8144);let a="http://localhost:3333";async function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{skipAuth:r=!1,headers:s,...l}=t,u={"Content-Type":"application/json",...s};if(!r){let e=n.t.getState().accessToken;e&&(u.Authorization="Bearer ".concat(e))}let c=await fetch("".concat(a).concat(e),{...l,headers:u});if(401===c.status&&!r){if(await o()){let t=n.t.getState().accessToken;u.Authorization="Bearer ".concat(t);let r=await fetch("".concat(a).concat(e),{...l,headers:u});if(!r.ok)throw new i(r.status,await r.text());return r.json()}throw n.t.getState().logout(),new i(401,"Session expired")}if(!c.ok)throw new i(c.status,await c.text());return c.json()}async function o(){let e=n.t.getState().refreshToken;if(!e)return!1;try{let t=await fetch("".concat(a,"/auth/refresh"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:e})});if(!t.ok)return!1;let r=await t.json();return n.t.getState().setTokens(r.data.accessToken,r.data.refreshToken),!0}catch(e){return!1}}class i extends Error{constructor(e,t){super(t),this.status=e,this.name="ApiError"}}},8144:function(e,t,r){"use strict";r.d(t,{t:function(){return s}});var n=r(8321),a=r(4452);let s=(0,n.U)()((0,a.tJ)(e=>({user:null,accessToken:null,refreshToken:null,isAuthenticated:!1,currentSiteId:null,setUser:t=>e({user:t}),setTokens:(t,r)=>e({accessToken:t,refreshToken:r}),setCurrentSite:t=>e({currentSiteId:t}),login:(t,r,n)=>e({user:t,accessToken:r,refreshToken:n,isAuthenticated:!0}),logout:()=>e({user:null,accessToken:null,refreshToken:null,isAuthenticated:!1,currentSiteId:null})}),{name:"safetywallet-auth",storage:(0,a.FL)(()=>localStorage),partialize:e=>({user:e.user,accessToken:e.accessToken,refreshToken:e.refreshToken,isAuthenticated:e.isAuthenticated,currentSiteId:e.currentSiteId})}))},2384:function(e,t,r){"use strict";r.d(t,{qE:function(){return y},Q5:function(){return w},Ct:function(){return b},zx:function(){return c},Zb:function(){return d},aY:function(){return h},SZ:function(){return g},Ol:function(){return f},ll:function(){return m},II:function(){return p},Od:function(){return v},cn:function(){return s}});var n=r(607),a=r(5579);function s(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,a.m6)((0,n.W)(t))}var o=r(7573),i=r(7653),l=r(9289);let u=(0,l.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=i.forwardRef((e,t)=>{let{className:r,variant:n,size:a,...i}=e;return(0,o.jsx)("button",{className:s(u({variant:n,size:a,className:r})),ref:t,...i})});c.displayName="Button";let d=i.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,o.jsx)("div",{ref:t,className:s("rounded-lg border bg-card text-card-foreground shadow-sm",r),...n})});d.displayName="Card";let f=i.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,o.jsx)("div",{ref:t,className:s("flex flex-col space-y-1.5 p-6",r),...n})});f.displayName="CardHeader";let m=i.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,o.jsx)("h3",{ref:t,className:s("text-2xl font-semibold leading-none tracking-tight",r),...n})});m.displayName="CardTitle";let g=i.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,o.jsx)("p",{ref:t,className:s("text-sm text-muted-foreground",r),...n})});g.displayName="CardDescription";let h=i.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,o.jsx)("div",{ref:t,className:s("p-6 pt-0",r),...n})});h.displayName="CardContent",i.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,o.jsx)("div",{ref:t,className:s("flex items-center p-6 pt-0",r),...n})}).displayName="CardFooter";let p=i.forwardRef((e,t)=>{let{className:r,type:n,...a}=e;return(0,o.jsx)("input",{type:n,className:s("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),ref:t,...a})});p.displayName="Input";let x=(0,l.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground",secondary:"border-transparent bg-secondary text-secondary-foreground",destructive:"border-transparent bg-destructive text-destructive-foreground",outline:"text-foreground",success:"border-transparent bg-success text-success-foreground",warning:"border-transparent bg-warning text-warning-foreground",info:"border-transparent bg-blue-500 text-white",neutral:"border-transparent bg-gray-500 text-white"}},defaultVariants:{variant:"default"}});function b(e){let{className:t,variant:r,...n}=e;return(0,o.jsx)("div",{className:s(x({variant:r}),t),...n})}function v(e){let{className:t,...r}=e;return(0,o.jsx)("div",{className:s("animate-pulse rounded-md bg-muted",t),...r})}let y=i.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,o.jsx)("span",{ref:t,className:s("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",r),...n})});y.displayName="Avatar",i.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,o.jsx)("img",{ref:t,className:s("aspect-square h-full w-full",r),...n})}).displayName="AvatarImage";let w=i.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,o.jsx)("span",{ref:t,className:s("flex h-full w-full items-center justify-center rounded-full bg-muted",r),...n})});w.displayName="AvatarFallback"}},function(e){e.O(0,[341,293,528,744],function(){return e(e.s=6495)}),_N_E=e.O()}]);