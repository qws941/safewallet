(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[61],{5622:function(e,t,r){Promise.resolve().then(r.bind(r,4529))},4529:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return h}});var n=r(7573),s=r(7653),a=r(1695),i=r(2384),c=r(8368),o=r(5118),l=r(7930),u=r(1988),d=r(5969),f=r(698),m=r(7066);let x=(0,r(2389).Z)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);function h(){let e=(0,a.useRouter)(),{currentSiteId:t}=(0,c.a)(),r=(0,l.NL)(),[h,p]=(0,s.useState)(null),{data:g,isLoading:y,error:v}=(0,u.a)({queryKey:["votes","current",t],queryFn:async()=>(await (0,o.S)("/votes/current?siteId=".concat(t))).data,enabled:!!t}),b=(0,d.D)({mutationFn:async e=>{await (0,o.S)("/votes",{method:"POST",body:JSON.stringify({siteId:t,candidateId:e})})},onSuccess:()=>{r.invalidateQueries({queryKey:["votes","current"]})}});return t?y?(0,n.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,n.jsx)("p",{children:"로딩 중..."})}):v?(0,n.jsx)("div",{className:"flex items-center justify-center min-h-screen p-4",children:(0,n.jsx)(i.Zb,{children:(0,n.jsxs)(i.aY,{className:"p-6 text-center",children:[(0,n.jsx)("p",{className:"text-destructive",children:"투표 정보를 불러오는데 실패했습니다."}),(0,n.jsx)("p",{className:"text-sm text-muted-foreground mt-2",children:v instanceof Error?v.message:"오류가 발생했습니다."})]})})}):(0,n.jsx)("div",{className:"min-h-screen bg-gray-50 p-4 pb-20",children:(0,n.jsxs)("div",{className:"max-w-md mx-auto space-y-4",children:[(0,n.jsx)(i.Zb,{children:(0,n.jsxs)(i.Ol,{children:[(0,n.jsxs)(i.ll,{className:"flex items-center gap-2",children:[(0,n.jsx)(f.Z,{className:"h-5 w-5 text-yellow-500"}),"우수 근로자 투표"]}),(0,n.jsxs)(i.SZ,{children:[(null==g?void 0:g.month)&&(e=>{let[t,r]=e.split("-");return"".concat(t,"년 ").concat(parseInt(r),"월")})(g.month)," 우수 근로자를 선정해주세요"]})]})}),(null==g?void 0:g.hasVoted)?(0,n.jsx)(i.Zb,{className:"border-green-200 bg-green-50",children:(0,n.jsxs)(i.aY,{className:"p-6 text-center",children:[(0,n.jsx)(m.Z,{className:"h-12 w-12 text-green-500 mx-auto mb-4"}),(0,n.jsx)("p",{className:"font-medium text-green-700",children:"투표 완료!"}),(0,n.jsx)("p",{className:"text-sm text-green-600 mt-1",children:"이번 달 투표에 참여해주셔서 감사합니다."})]})}):(0,n.jsxs)(n.Fragment,{children:[(null==g?void 0:g.candidates.length)===0?(0,n.jsx)(i.Zb,{children:(0,n.jsx)(i.aY,{className:"p-6 text-center",children:(0,n.jsx)("p",{className:"text-muted-foreground",children:"등록된 후보가 없습니다."})})}):(0,n.jsx)("div",{className:"space-y-3",children:null==g?void 0:g.candidates.map(e=>(0,n.jsx)(i.Zb,{className:"cursor-pointer transition-all ".concat(h===e.user.id?"border-primary ring-2 ring-primary/20":"hover:border-gray-300"),onClick:()=>p(e.user.id),children:(0,n.jsxs)(i.aY,{className:"p-4 flex items-center gap-4",children:[(0,n.jsx)("div",{className:"flex-shrink-0 w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center",children:(0,n.jsx)(x,{className:"h-6 w-6 text-gray-400"})}),(0,n.jsxs)("div",{className:"flex-grow",children:[(0,n.jsx)("p",{className:"font-medium",children:e.user.nameMasked||e.user.name||"익명"}),(0,n.jsxs)("p",{className:"text-sm text-muted-foreground",children:[e.user.companyName&&"".concat(e.user.companyName),e.user.tradeType&&" \xb7 ".concat(e.user.tradeType)]})]}),h===e.user.id&&(0,n.jsx)(m.Z,{className:"h-6 w-6 text-primary flex-shrink-0"})]})},e.id))}),(null==g?void 0:g.candidates)&&g.candidates.length>0&&(0,n.jsx)(i.zx,{className:"w-full",size:"lg",disabled:!h||b.isPending,onClick:()=>{h&&b.mutate(h)},children:b.isPending?"투표 중...":"투표하기"}),b.error&&(0,n.jsx)("p",{className:"text-sm text-destructive text-center",children:b.error instanceof Error?b.error.message:"투표에 실패했습니다."})]})]})}):(0,n.jsx)("div",{className:"flex items-center justify-center min-h-screen p-4",children:(0,n.jsx)(i.Zb,{children:(0,n.jsxs)(i.aY,{className:"p-6 text-center",children:[(0,n.jsx)("p",{className:"text-muted-foreground",children:"현장을 먼저 선택해주세요."}),(0,n.jsx)(i.zx,{onClick:()=>e.push("/join"),className:"mt-4",children:"현장 선택"})]})})})}},8368:function(e,t,r){"use strict";r.d(t,{a:function(){return s}});var n=r(8144);function s(){let{user:e,isAuthenticated:t,currentSiteId:r,login:s,logout:a,setCurrentSite:i}=(0,n.t)();return{user:e,isAuthenticated:t,currentSiteId:r,login:s,logout:a,setCurrentSite:i}}},5118:function(e,t,r){"use strict";r.d(t,{S:function(){return a}});var n=r(8144);let s="https://safework2.jclee.me/api";async function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{skipAuth:r=!1,headers:a,...o}=t,l={"Content-Type":"application/json",...a};if(!r){let e=n.t.getState().accessToken;e&&(l.Authorization="Bearer ".concat(e))}let u=await fetch("".concat(s).concat(e),{...o,headers:l});if(401===u.status&&!r){if(await i()){let t=n.t.getState().accessToken;l.Authorization="Bearer ".concat(t);let r=await fetch("".concat(s).concat(e),{...o,headers:l});if(!r.ok)throw new c(r.status,await r.text());return r.json()}throw n.t.getState().logout(),new c(401,"Session expired")}if(!u.ok)throw new c(u.status,await u.text());return u.json()}async function i(){let e=n.t.getState().refreshToken;if(!e)return!1;try{let t=await fetch("".concat(s,"/auth/refresh"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:e})});if(!t.ok)return!1;let r=await t.json();return n.t.getState().setTokens(r.data.accessToken,r.data.refreshToken),!0}catch(e){return!1}}class c extends Error{constructor(e,t){super(t),this.status=e,this.name="ApiError"}}},8144:function(e,t,r){"use strict";r.d(t,{t:function(){return a}});var n=r(8321),s=r(4452);let a=(0,n.U)()((0,s.tJ)(e=>({user:null,accessToken:null,refreshToken:null,isAuthenticated:!1,currentSiteId:null,setUser:t=>e({user:t}),setTokens:(t,r)=>e({accessToken:t,refreshToken:r}),setCurrentSite:t=>e({currentSiteId:t}),login:(t,r,n)=>e({user:t,accessToken:r,refreshToken:n,isAuthenticated:!0}),logout:()=>e({user:null,accessToken:null,refreshToken:null,isAuthenticated:!1,currentSiteId:null})}),{name:"safetywallet-auth",storage:(0,s.FL)(()=>localStorage),partialize:e=>({user:e.user,accessToken:e.accessToken,refreshToken:e.refreshToken,isAuthenticated:e.isAuthenticated,currentSiteId:e.currentSiteId})}))},2389:function(e,t,r){"use strict";r.d(t,{Z:function(){return o}});var n=r(7653);let s=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),a=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter((e,t,r)=>!!e&&r.indexOf(e)===t).join(" ")};var i={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let c=(0,n.forwardRef)((e,t)=>{let{color:r="currentColor",size:s=24,strokeWidth:c=2,absoluteStrokeWidth:o,className:l="",children:u,iconNode:d,...f}=e;return(0,n.createElement)("svg",{ref:t,...i,width:s,height:s,stroke:r,strokeWidth:o?24*Number(c)/Number(s):c,className:a("lucide",l),...f},[...d.map(e=>{let[t,r]=e;return(0,n.createElement)(t,r)}),...Array.isArray(u)?u:[u]])}),o=(e,t)=>{let r=(0,n.forwardRef)((r,i)=>{let{className:o,...l}=r;return(0,n.createElement)(c,{ref:i,iconNode:t,className:a("lucide-".concat(s(e)),o),...l})});return r.displayName="".concat(e),r}},698:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});let n=(0,r(2389).Z)("Award",[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]])},7066:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});let n=(0,r(2389).Z)("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},2384:function(e,t,r){"use strict";r.d(t,{qE:function(){return b},Q5:function(){return j},Ct:function(){return y},zx:function(){return u},Zb:function(){return d},aY:function(){return h},SZ:function(){return x},Ol:function(){return f},ll:function(){return m},II:function(){return p},Od:function(){return v},cn:function(){return a}});var n=r(607),s=r(5579);function a(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,s.m6)((0,n.W)(t))}var i=r(7573),c=r(7653),o=r(9289);let l=(0,o.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),u=c.forwardRef((e,t)=>{let{className:r,variant:n,size:s,...c}=e;return(0,i.jsx)("button",{className:a(l({variant:n,size:s,className:r})),ref:t,...c})});u.displayName="Button";let d=c.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,i.jsx)("div",{ref:t,className:a("rounded-lg border bg-card text-card-foreground shadow-sm",r),...n})});d.displayName="Card";let f=c.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,i.jsx)("div",{ref:t,className:a("flex flex-col space-y-1.5 p-6",r),...n})});f.displayName="CardHeader";let m=c.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,i.jsx)("h3",{ref:t,className:a("text-2xl font-semibold leading-none tracking-tight",r),...n})});m.displayName="CardTitle";let x=c.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,i.jsx)("p",{ref:t,className:a("text-sm text-muted-foreground",r),...n})});x.displayName="CardDescription";let h=c.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,i.jsx)("div",{ref:t,className:a("p-6 pt-0",r),...n})});h.displayName="CardContent",c.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,i.jsx)("div",{ref:t,className:a("flex items-center p-6 pt-0",r),...n})}).displayName="CardFooter";let p=c.forwardRef((e,t)=>{let{className:r,type:n,...s}=e;return(0,i.jsx)("input",{type:n,className:a("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),ref:t,...s})});p.displayName="Input";let g=(0,o.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground",secondary:"border-transparent bg-secondary text-secondary-foreground",destructive:"border-transparent bg-destructive text-destructive-foreground",outline:"text-foreground",success:"border-transparent bg-success text-success-foreground",warning:"border-transparent bg-warning text-warning-foreground",info:"border-transparent bg-blue-500 text-white",neutral:"border-transparent bg-gray-500 text-white"}},defaultVariants:{variant:"default"}});function y(e){let{className:t,variant:r,...n}=e;return(0,i.jsx)("div",{className:a(g({variant:r}),t),...n})}function v(e){let{className:t,...r}=e;return(0,i.jsx)("div",{className:a("animate-pulse rounded-md bg-muted",t),...r})}let b=c.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,i.jsx)("span",{ref:t,className:a("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",r),...n})});b.displayName="Avatar",c.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,i.jsx)("img",{ref:t,className:a("aspect-square h-full w-full",r),...n})}).displayName="AvatarImage";let j=c.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,i.jsx)("span",{ref:t,className:a("flex h-full w-full items-center justify-center rounded-full bg-muted",r),...n})});j.displayName="AvatarFallback"}},function(e){e.O(0,[341,953,485,293,528,744],function(){return e(e.s=5622)}),_N_E=e.O()}]);