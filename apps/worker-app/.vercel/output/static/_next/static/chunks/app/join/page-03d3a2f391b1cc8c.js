(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[532],{2864:function(e,t,r){Promise.resolve().then(r.bind(r,6132))},6132:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return u}});var n=r(7573),a=r(7653),s=r(1695),i=r(2384),o=r(8368),l=r(5118);function u(){let e=(0,s.useRouter)(),{setCurrentSite:t}=(0,o.a)(),[r,u]=(0,a.useState)(""),[c,d]=(0,a.useState)(""),[f,m]=(0,a.useState)(!1),x=async n=>{n.preventDefault(),d(""),m(!0);try{let n=await (0,l.S)("/sites/join",{method:"POST",body:JSON.stringify({code:r})});t(n.data.site.id),e.replace("/home")}catch(t){try{var a,s;let r=JSON.parse(t.message||"{}");if((null===(a=r.error)||void 0===a?void 0:a.code)==="ALREADY_MEMBER"){e.replace("/home");return}d((null===(s=r.error)||void 0===s?void 0:s.message)||"유효하지 않은 코드입니다.")}catch(e){d("유효하지 않은 코드입니다.")}}finally{m(!1)}};return(0,n.jsx)("div",{className:"flex items-center justify-center min-h-screen p-4 bg-gray-50",children:(0,n.jsxs)(i.Zb,{className:"w-full max-w-sm",children:[(0,n.jsxs)(i.Ol,{className:"text-center",children:[(0,n.jsx)(i.ll,{className:"text-2xl",children:"현장 참여"}),(0,n.jsx)(i.SZ,{children:"QR 코드를 스캔하거나 참여 코드를 입력하세요"})]}),(0,n.jsx)(i.aY,{children:(0,n.jsxs)("form",{onSubmit:x,className:"space-y-4",children:[(0,n.jsx)("div",{children:(0,n.jsx)(i.II,{type:"text",placeholder:"참여 코드 입력",value:r,onChange:e=>u(e.target.value.toUpperCase()),className:"text-center text-lg uppercase",disabled:f})}),c&&(0,n.jsx)("p",{className:"text-sm text-destructive text-center",children:c}),(0,n.jsx)(i.zx,{type:"submit",className:"w-full",disabled:f||!r,children:f?"참여 중...":"현장 참여하기"}),(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)("div",{className:"absolute inset-0 flex items-center",children:(0,n.jsx)("span",{className:"w-full border-t"})}),(0,n.jsx)("div",{className:"relative flex justify-center text-xs uppercase",children:(0,n.jsx)("span",{className:"bg-background px-2 text-muted-foreground",children:"or"})})]}),(0,n.jsx)(i.zx,{type:"button",variant:"outline",className:"w-full",onClick:()=>{alert("QR 스캐너 기능은 준비 중입니다.")},children:"QR 코드 스캔"})]})})]})})}},8368:function(e,t,r){"use strict";r.d(t,{a:function(){return a}});var n=r(8144);function a(){let{user:e,isAuthenticated:t,currentSiteId:r,login:a,logout:s,setCurrentSite:i}=(0,n.t)();return{user:e,isAuthenticated:t,currentSiteId:r,login:a,logout:s,setCurrentSite:i}}},5118:function(e,t,r){"use strict";r.d(t,{S:function(){return s}});var n=r(8144);let a="https://safework2.jclee.me/api";async function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{skipAuth:r=!1,headers:s,...l}=t,u={"Content-Type":"application/json",...s};if(!r){let e=n.t.getState().accessToken;e&&(u.Authorization="Bearer ".concat(e))}let c=await fetch("".concat(a).concat(e),{...l,headers:u});if(401===c.status&&!r){if(await i()){let t=n.t.getState().accessToken;u.Authorization="Bearer ".concat(t);let r=await fetch("".concat(a).concat(e),{...l,headers:u});if(!r.ok)throw new o(r.status,await r.text());return r.json()}throw n.t.getState().logout(),new o(401,"Session expired")}if(!c.ok)throw new o(c.status,await c.text());return c.json()}async function i(){let e=n.t.getState().refreshToken;if(!e)return!1;try{let t=await fetch("".concat(a,"/auth/refresh"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:e})});if(!t.ok)return!1;let r=await t.json();return n.t.getState().setTokens(r.data.accessToken,r.data.refreshToken),!0}catch(e){return!1}}class o extends Error{constructor(e,t){super(t),this.status=e,this.name="ApiError"}}},8144:function(e,t,r){"use strict";r.d(t,{t:function(){return s}});var n=r(8321),a=r(4452);let s=(0,n.U)()((0,a.tJ)(e=>({user:null,accessToken:null,refreshToken:null,isAuthenticated:!1,currentSiteId:null,setUser:t=>e({user:t}),setTokens:(t,r)=>e({accessToken:t,refreshToken:r}),setCurrentSite:t=>e({currentSiteId:t}),login:(t,r,n)=>e({user:t,accessToken:r,refreshToken:n,isAuthenticated:!0}),logout:()=>e({user:null,accessToken:null,refreshToken:null,isAuthenticated:!1,currentSiteId:null})}),{name:"safetywallet-auth",storage:(0,a.FL)(()=>localStorage),partialize:e=>({user:e.user,accessToken:e.accessToken,refreshToken:e.refreshToken,isAuthenticated:e.isAuthenticated,currentSiteId:e.currentSiteId})}))},2384:function(e,t,r){"use strict";r.d(t,{qE:function(){return y},Q5:function(){return w},Ct:function(){return b},zx:function(){return c},Zb:function(){return d},aY:function(){return p},SZ:function(){return x},Ol:function(){return f},ll:function(){return m},II:function(){return g},Od:function(){return v},cn:function(){return s}});var n=r(607),a=r(5579);function s(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,a.m6)((0,n.W)(t))}var i=r(7573),o=r(7653),l=r(9289);let u=(0,l.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=o.forwardRef((e,t)=>{let{className:r,variant:n,size:a,...o}=e;return(0,i.jsx)("button",{className:s(u({variant:n,size:a,className:r})),ref:t,...o})});c.displayName="Button";let d=o.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,i.jsx)("div",{ref:t,className:s("rounded-lg border bg-card text-card-foreground shadow-sm",r),...n})});d.displayName="Card";let f=o.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,i.jsx)("div",{ref:t,className:s("flex flex-col space-y-1.5 p-6",r),...n})});f.displayName="CardHeader";let m=o.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,i.jsx)("h3",{ref:t,className:s("text-2xl font-semibold leading-none tracking-tight",r),...n})});m.displayName="CardTitle";let x=o.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,i.jsx)("p",{ref:t,className:s("text-sm text-muted-foreground",r),...n})});x.displayName="CardDescription";let p=o.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,i.jsx)("div",{ref:t,className:s("p-6 pt-0",r),...n})});p.displayName="CardContent",o.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,i.jsx)("div",{ref:t,className:s("flex items-center p-6 pt-0",r),...n})}).displayName="CardFooter";let g=o.forwardRef((e,t)=>{let{className:r,type:n,...a}=e;return(0,i.jsx)("input",{type:n,className:s("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),ref:t,...a})});g.displayName="Input";let h=(0,l.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground",secondary:"border-transparent bg-secondary text-secondary-foreground",destructive:"border-transparent bg-destructive text-destructive-foreground",outline:"text-foreground",success:"border-transparent bg-success text-success-foreground",warning:"border-transparent bg-warning text-warning-foreground",info:"border-transparent bg-blue-500 text-white",neutral:"border-transparent bg-gray-500 text-white"}},defaultVariants:{variant:"default"}});function b(e){let{className:t,variant:r,...n}=e;return(0,i.jsx)("div",{className:s(h({variant:r}),t),...n})}function v(e){let{className:t,...r}=e;return(0,i.jsx)("div",{className:s("animate-pulse rounded-md bg-muted",t),...r})}let y=o.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,i.jsx)("span",{ref:t,className:s("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",r),...n})});y.displayName="Avatar",o.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,i.jsx)("img",{ref:t,className:s("aspect-square h-full w-full",r),...n})}).displayName="AvatarImage";let w=o.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,i.jsx)("span",{ref:t,className:s("flex h-full w-full items-center justify-center rounded-full bg-muted",r),...n})});w.displayName="AvatarFallback"}},function(e){e.O(0,[341,293,528,744],function(){return e(e.s=2864)}),_N_E=e.O()}]);