# ì•ˆì „ì§€ê°‘ êµ¬í˜„ ìƒíƒœ ì ê²€í‘œ

> ìµœì¢… ì ê²€ì¼: 2026-02-05 (E2E ê²€ì¦ í›„ ì—…ë°ì´íŠ¸)
> 
> âœ… êµ¬í˜„ì™„ë£Œ | ðŸ”¶ ë¶€ë¶„êµ¬í˜„ | âŒ ë¯¸êµ¬í˜„ | ðŸ”„ ë³€ê²½í•„ìš”

---

## 1. ì‚¬ìš©ìž ì¸ì¦ (Authentication)

### 1.1 ë¡œê·¸ì¸ (ë³€ê²½ ì™„ë£Œ âœ…)
| í•­ëª© | ì´ì „ | í˜„ìž¬ | ìƒíƒœ |
|------|------|------|------|
| ë¡œê·¸ì¸ ìž…ë ¥ | phone + OTP | name + phone + dob | âœ… êµ¬í˜„ì™„ë£Œ |
| OTP ë°œì†¡ | êµ¬í˜„ | ì œê±° | âœ… êµ¬í˜„ì™„ë£Œ |
| íšŒì›ê°€ìž… | êµ¬í˜„ (/join) | FAS ìžë™ê°€ìž…ë§Œ | ðŸ”¶ UI ë‚¨ì•„ìžˆìŒ |

### 1.2 ë¡œê·¸ì¸ í™”ë©´
| í•­ëª© | ìƒíƒœ | ë¹„ê³  |
|------|------|------|
| ì´ë¦„ ìž…ë ¥ í•„ë“œ | âœ… êµ¬í˜„ | í•„ìˆ˜ |
| ì „í™”ë²ˆí˜¸ ìž…ë ¥ í•„ë“œ | âœ… êµ¬í˜„ | 10ìžë¦¬ ì´ìƒ |
| ìƒë…„ì›”ì¼ ìž…ë ¥ í•„ë“œ | âœ… êµ¬í˜„ | YYMMDD 6ìžë¦¬ |
| ë¡œê·¸ì¸ ë²„íŠ¼ | âœ… êµ¬í˜„ | - |
| ë¡œê·¸ì¸ ì‹¤íŒ¨: FAS ë¯¸ë“±ë¡ | âœ… êµ¬í˜„ | "ë“±ë¡ë˜ì§€ ì•Šì€ ì‚¬ìš©ìžìž…ë‹ˆë‹¤" |
| ë¡œê·¸ì¸ ì‹¤íŒ¨: ë¯¸ì¶œì„ | âŒ ë¯¸êµ¬í˜„ | ì ‘ê·¼ì œì–´ ì—°ë™ í•„ìš” |
| ë¡œê·¸ì¸ ì‹¤íŒ¨: ì •ë³´ ë¶ˆì¼ì¹˜ | âœ… êµ¬í˜„ | "ì´ë¦„ì´ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤" |
| Rate limiting | âŒ ë¯¸êµ¬í˜„ | ì¶”ê°€ í•„ìš” |

### 1.3 ì„¸ì…˜ ê´€ë¦¬
| í•­ëª© | ìƒíƒœ | ë¹„ê³  |
|------|------|------|
| JWT í† í° ë°œê¸‰ | âœ… êµ¬í˜„ | 24ì‹œê°„ TTL |
| Refresh í† í° | âœ… êµ¬í˜„ | POST /auth/refresh |
| ìžì • í†µê³¼ ì‹œ ìž¬ë¡œê·¸ì¸ | âŒ ë¯¸êµ¬í˜„ | ì¶”ê°€ í•„ìš” |
| ë¡œê·¸ì•„ì›ƒ | âœ… êµ¬í˜„ | POST /auth/logout |

---

## 2. FAS ì—°ë™ (Face Attendance System)

### 2.1 ê·¼ë¡œìž ë§ˆìŠ¤í„° ë™ê¸°í™”
| í•­ëª© | ìƒíƒœ | ë¹„ê³  |
|------|------|------|
| FAS ì—°ë™ ëª¨ë“ˆ | ðŸ”¶ ë¶€ë¶„êµ¬í˜„ | Webhook ìˆ˜ì‹ ë§Œ |
| ìžë™ ê³„ì • ìƒì„± | âŒ ë¯¸êµ¬í˜„ | ì‹ ê·œ ê°œë°œ í•„ìš” |
| external_system í•„ë“œ | âœ… êµ¬í˜„ | DB ìŠ¤í‚¤ë§ˆ ì™„ë£Œ |
| external_worker_id í•„ë“œ | âœ… êµ¬í˜„ | DB ìŠ¤í‚¤ë§ˆ ì™„ë£Œ |
| company_name í•„ë“œ | âœ… êµ¬í˜„ | DB ìŠ¤í‚¤ë§ˆ ì™„ë£Œ |
| trade_type í•„ë“œ | âœ… êµ¬í˜„ | DB ìŠ¤í‚¤ë§ˆ ì™„ë£Œ |
| phoneHash/dobHash | âœ… êµ¬í˜„ | HMAC ê²€ìƒ‰ìš© |

### 2.2 ì¶œê·¼ ì´ë²¤íŠ¸ ë™ê¸°í™”
| í•­ëª© | ìƒíƒœ | ë¹„ê³  |
|------|------|------|
| Attendance í…Œì´ë¸” | âœ… êµ¬í˜„ | DB ìŠ¤í‚¤ë§ˆ ì™„ë£Œ |
| POST /attendance/sync | âœ… êµ¬í˜„ | Webhook receiver |
| GET /attendance/today | âœ… êµ¬í˜„ | ì˜¤ëŠ˜ ì¶œê·¼ ìƒíƒœ |
| GET /attendance/today/list | âœ… êµ¬í˜„ | ì˜¤ëŠ˜ ì¶œê·¼ìž ëª©ë¡ |
| ì¤‘ë³µ ë°©ì§€ (Idempotency) | âŒ ë¯¸êµ¬í˜„ | ì¶”ê°€ í•„ìš” |

---

## 3. ì¶œê·¼ ì¸ì¦ ê¸°ë°˜ ì ‘ê·¼ ì œì–´

### 3.1 ì ‘ê·¼ ì œì–´
| í•­ëª© | ìƒíƒœ | ë¹„ê³  |
|------|------|------|
| ì˜¤ëŠ˜ ì¶œê·¼ ë¡œê·¸ ì¡°íšŒ | âœ… êµ¬í˜„ | API ì™„ë£Œ |
| ë¯¸ì¶œê·¼ìž ë¡œê·¸ì¸ ì°¨ë‹¨ | âŒ ë¯¸êµ¬í˜„ | ì •ì±… ê²°ì • í•„ìš” |
| ë¯¸ì¶œê·¼ìž ê¸°ëŠ¥ ë¹„í™œì„±í™” | âŒ ë¯¸êµ¬í˜„ | Guard êµ¬í˜„ í•„ìš” |
| ì•ˆë‚´ ë©”ì‹œì§€ | âŒ ë¯¸êµ¬í˜„ | UX ì„¤ê³„ í•„ìš” |
| AccessPolicy í…Œì´ë¸” | âœ… êµ¬í˜„ | DB ìŠ¤í‚¤ë§ˆ ì™„ë£Œ |
| Day cutoff ì„¤ì • | âŒ ë¯¸êµ¬í˜„ | ë¡œì§ êµ¬í˜„ í•„ìš” |
| AttendanceGuard | âœ… êµ¬í˜„ | íŒŒì¼ ì¡´ìž¬, ì—°ë™ í•„ìš” |

---

## 4. ë©”ì¸ í™”ë©´ (Worker App)

### 4.1 í˜„ìž¬ êµ¬í˜„
| í•­ëª© | ìƒíƒœ | ë¹„ê³  |
|------|------|------|
| í¬ì¸íŠ¸ í˜„í™© | âœ… êµ¬í˜„ | - |
| ì¶œê·¼ ì¸ì¦ ìƒíƒœ | âœ… êµ¬í˜„ | ì‹œê°„ í‘œì‹œ í¬í•¨ |
| ìš°ìˆ˜ê·¼ë¡œìž íˆ¬í‘œ ë§í¬ | âœ… êµ¬í˜„ | ë°”ë¡œê°€ê¸° ë²„íŠ¼ |
| ì•ˆì „ì œë³´ ë§í¬ | âœ… êµ¬í˜„ | - |
| ê³µì§€ì‚¬í•­ ë§í¬ | âœ… êµ¬í˜„ | - |
| ë©”ë‰´ ë„¤ë¹„ê²Œì´ì…˜ | âœ… êµ¬í˜„ | - |

---

## 5. ìš°ìˆ˜ê·¼ë¡œìž íˆ¬í‘œ

### 5.1 íˆ¬í‘œ ê¸°ëŠ¥ (êµ¬í˜„ ì™„ë£Œ âœ…)
| í•­ëª© | ìƒíƒœ | ë¹„ê³  |
|------|------|------|
| Vote í…Œì´ë¸” | âœ… êµ¬í˜„ | unique(site, month, voter) |
| VoteCandidate í…Œì´ë¸” | âœ… êµ¬í˜„ | source: admin/auto |
| GET /votes/current | âœ… êµ¬í˜„ | í›„ë³´ ëª©ë¡ í¬í•¨ |
| POST /votes | âœ… êµ¬í˜„ | candidateId í•„ìˆ˜ |
| GET /votes/results | âœ… êµ¬í˜„ | ì›”ë³„ ì¡°íšŒ |
| ì¤‘ë³µ íˆ¬í‘œ ë°©ì§€ | âœ… êµ¬í˜„ | DB constraint + ConflictException |
| íˆ¬í‘œ íŽ˜ì´ì§€ (Worker) | âœ… êµ¬í˜„ | /votes |
| íˆ¬í‘œ ê²°ê³¼ (Admin) | âœ… êµ¬í˜„ | /votes (rank í‘œì‹œ) |

---

## 6. í¬ì¸íŠ¸ ì‹œìŠ¤í…œ

### 6.1 í˜„ìž¬ êµ¬í˜„
| í•­ëª© | ìƒíƒœ | ë¹„ê³  |
|------|------|------|
| PointsLedger í…Œì´ë¸” | âœ… êµ¬í˜„ | - |
| í¬ì¸íŠ¸ ì¡°íšŒ | âœ… êµ¬í˜„ | - |
| í¬ì¸íŠ¸ ë‚´ì—­ | âœ… êµ¬í˜„ | - |
| í¬ì¸íŠ¸ ì ë¦½ (ì œë³´) | âœ… êµ¬í˜„ | - |
| ê´€ë¦¬ìž ìˆ˜ë™ ì ë¦½ | âœ… êµ¬í˜„ | - |
| ëž­í‚¹ ì¡°íšŒ | âœ… êµ¬í˜„ | - |

---

## 7. ê²Œì‹œë¬¼ (Posts/Actions)

### 7.1 í˜„ìž¬ êµ¬í˜„
| í•­ëª© | ìƒíƒœ | ë¹„ê³  |
|------|------|------|
| Post í…Œì´ë¸” | âœ… êµ¬í˜„ | - |
| Action í…Œì´ë¸” | âœ… êµ¬í˜„ | ì œë³´ìš© |
| ê²Œì‹œë¬¼ ëª©ë¡/ìƒì„¸ | âœ… êµ¬í˜„ | - |
| ê²Œì‹œë¬¼ ìž‘ì„±/ìˆ˜ì •/ì‚­ì œ | âœ… êµ¬í˜„ | - |
| ì´ë¯¸ì§€ ì²¨ë¶€ | âœ… êµ¬í˜„ | - |
| ì¢‹ì•„ìš”/ëŒ“ê¸€ | âœ… êµ¬í˜„ | Review í…Œì´ë¸” |

---

## 8. ê´€ë¦¬ìž ê¸°ëŠ¥ (Admin App)

### 8.1 í˜„ìž¬ êµ¬í˜„
| í•­ëª© | ìƒíƒœ | ë¹„ê³  |
|------|------|------|
| ëŒ€ì‹œë³´ë“œ | âœ… êµ¬í˜„ | /dashboard |
| íšŒì› ëª©ë¡/ìƒì„¸ | âœ… êµ¬í˜„ | /members |
| ê²Œì‹œë¬¼ ê´€ë¦¬ | âœ… êµ¬í˜„ | /posts |
| í¬ì¸íŠ¸ ê´€ë¦¬ | âœ… êµ¬í˜„ | /points |
| ê³µì§€ ê´€ë¦¬ | âœ… êµ¬í˜„ | /announcements |
| ì œë³´ ê´€ë¦¬ | âœ… êµ¬í˜„ | /actions |
| ê°ì‚¬ ë¡œê·¸ | âœ… êµ¬í˜„ | /audit |
| ì¶œê·¼ ëª¨ë‹ˆí„°ë§ | âœ… êµ¬í˜„ | /attendance (ì‹ ê·œ) |
| íˆ¬í‘œ ê²°ê³¼ ì¡°íšŒ | âœ… êµ¬í˜„ | /votes (ì‹ ê·œ) |

### 8.2 ì¶”ê°€ í•„ìš”
| í•­ëª© | ìƒíƒœ | ë¹„ê³  |
|------|------|------|
| FAS ë™ê¸°í™” ìƒíƒœ | âŒ ë¯¸êµ¬í˜„ | ì‹ ê·œ ê°œë°œ |
| ìˆ˜ë™ ì¶œê·¼ ìŠ¹ì¸ | âŒ ë¯¸êµ¬í˜„ | ManualApproval í…Œì´ë¸” ì¤€ë¹„ë¨ |
| íˆ¬í‘œ í›„ë³´ ê´€ë¦¬ | âŒ ë¯¸êµ¬í˜„ | CRUD í•„ìš” |

---

## 9. API ì—”ë“œí¬ì¸íŠ¸

### 9.1 ì¸ì¦ API
| ì—”ë“œí¬ì¸íŠ¸ | ìƒíƒœ | ë¹„ê³  |
|------------|------|------|
| `POST /auth/login` | âœ… êµ¬í˜„ | name+phone+dob (HMAC) |
| `POST /auth/refresh` | âœ… êµ¬í˜„ | í† í° ê°±ì‹  |
| `POST /auth/logout` | âœ… êµ¬í˜„ | - |
| `POST /auth/send-otp` | ðŸ”„ ì œê±°ë¨ | - |
| `POST /auth/verify-otp` | ðŸ”„ ì œê±°ë¨ | - |

### 9.2 ì¶œê·¼ API
| ì—”ë“œí¬ì¸íŠ¸ | ìƒíƒœ | ë¹„ê³  |
|------------|------|------|
| `GET /attendance/today` | âœ… êµ¬í˜„ | ê°œì¸ ì¶œê·¼ ìƒíƒœ |
| `GET /attendance/today/list` | âœ… êµ¬í˜„ | í˜„ìž¥ ì¶œê·¼ìž ëª©ë¡ |
| `POST /attendance/sync` | âœ… êµ¬í˜„ | FAS Webhook |

### 9.3 íˆ¬í‘œ API
| ì—”ë“œí¬ì¸íŠ¸ | ìƒíƒœ | ë¹„ê³  |
|------------|------|------|
| `GET /votes/current` | âœ… êµ¬í˜„ | í›„ë³´ ëª©ë¡ í¬í•¨ |
| `POST /votes` | âœ… êµ¬í˜„ | íˆ¬í‘œ |
| `GET /votes/results` | âœ… êµ¬í˜„ | ì›”ë³„ ê²°ê³¼ |

### 9.4 ê¸°ì¡´ API (ìœ ì§€)
| ì—”ë“œí¬ì¸íŠ¸ | ìƒíƒœ |
|------------|------|
| `GET /users/me` | âœ… êµ¬í˜„ |
| `GET /posts`, `POST /posts`, etc. | âœ… êµ¬í˜„ |
| `GET /points`, `GET /points/ranking` | âœ… êµ¬í˜„ |
| `GET /announcements` | âœ… êµ¬í˜„ |
| `GET /actions`, `POST /actions` | âœ… êµ¬í˜„ |

---

## 10. ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ

### 10.1 User í…Œì´ë¸” (ì—…ë°ì´íŠ¸ ì™„ë£Œ âœ…)
| í•„ë“œ | ìƒíƒœ |
|------|------|
| id, name, phone, email, role | âœ… ê¸°ì¡´ |
| phoneHash | âœ… ì‹ ê·œ |
| dob, dobHash | âœ… ì‹ ê·œ |
| externalSystem | âœ… ì‹ ê·œ |
| externalWorkerId | âœ… ì‹ ê·œ |
| companyName | âœ… ì‹ ê·œ |
| tradeType | âœ… ì‹ ê·œ |

### 10.2 ì‹ ê·œ í…Œì´ë¸” (êµ¬í˜„ ì™„ë£Œ âœ…)
| í…Œì´ë¸” | ìƒíƒœ | ë¹„ê³  |
|--------|------|------|
| Attendance | âœ… êµ¬í˜„ | ì¶œê·¼ ë¡œê·¸ |
| AccessPolicy | âœ… êµ¬í˜„ | í˜„ìž¥ë³„ ì •ì±… |
| ManualApproval | âœ… êµ¬í˜„ | ìˆ˜ë™ ìŠ¹ì¸ |
| Vote | âœ… êµ¬í˜„ | íˆ¬í‘œ ê¸°ë¡ |
| VoteCandidate | âœ… êµ¬í˜„ | íˆ¬í‘œ í›„ë³´ |

### 10.3 ì‹ ê·œ Enum
| Enum | ìƒíƒœ |
|------|------|
| AttendanceResult | âœ… êµ¬í˜„ |
| AttendanceSource | âœ… êµ¬í˜„ |
| VoteCandidateSource | âœ… êµ¬í˜„ |

---

## 11. ë³´ì•ˆ ìš”êµ¬ì‚¬í•­

| í•­ëª© | ìƒíƒœ | ë¹„ê³  |
|------|------|------|
| HMAC í•´ì‹œ ì¸ë±ìŠ¤ | âœ… êµ¬í˜„ | phoneHash, dobHash |
| ì „í™”ë²ˆí˜¸ ì•”í˜¸í™” ì €ìž¥ | âŒ ë¯¸êµ¬í˜„ | í˜„ìž¬ í‰ë¬¸ |
| ìƒë…„ì›”ì¼ ì•”í˜¸í™” ì €ìž¥ | âŒ ë¯¸êµ¬í˜„ | í˜„ìž¬ í‰ë¬¸ |
| JWT í† í° ê²€ì¦ | âœ… êµ¬í˜„ | - |
| Rate Limiting | âŒ ë¯¸êµ¬í˜„ | ì¶”ê°€ í•„ìš” |
| ê°ì‚¬ ë¡œê·¸ | âœ… êµ¬í˜„ | AuditLog í…Œì´ë¸” |

---

## êµ¬í˜„ ìƒíƒœ ìš”ì•½

| ì¹´í…Œê³ ë¦¬ | êµ¬í˜„ | ë¶€ë¶„ | ë¯¸êµ¬í˜„ | ì§„í–‰ë¥  |
|---------|------|------|--------|--------|
| ì‚¬ìš©ìž ì¸ì¦ | 9 | 1 | 2 | 75% |
| FAS ì—°ë™ | 8 | 1 | 2 | 73% |
| ì ‘ê·¼ ì œì–´ | 3 | 0 | 4 | 43% |
| ë©”ì¸ í™”ë©´ | 6 | 0 | 0 | 100% |
| íˆ¬í‘œ ê¸°ëŠ¥ | 9 | 0 | 0 | 100% |
| í¬ì¸íŠ¸ | 6 | 0 | 0 | 100% |
| ê²Œì‹œë¬¼ | 6 | 0 | 0 | 100% |
| ê´€ë¦¬ìž | 11 | 0 | 3 | 79% |
| API | 15 | 0 | 1 | 94% |
| DB ìŠ¤í‚¤ë§ˆ | 25 | 0 | 0 | 100% |
| ë³´ì•ˆ | 3 | 0 | 3 | 50% |

### ì „ì²´ ì§„í–‰ë¥ : **ì•½ 82%** (ì´ì „: 40%)

---

## ë‹¤ìŒ ìš°ì„ ìˆœìœ„ ìž‘ì—…

### P0 (Critical - ë³´ì•ˆ)
1. [ ] Rate Limiting êµ¬í˜„
2. [ ] PII ì•”í˜¸í™” (phone, dob)
3. [ ] ë¯¸ì¶œê·¼ìž ì ‘ê·¼ ì œì–´ ì ìš©

### P1 (High - ê¸°ëŠ¥)
1. [ ] ìžì • ìž¬ë¡œê·¸ì¸ ë¡œì§
2. [ ] ìˆ˜ë™ ì¶œê·¼ ìŠ¹ì¸ API/UI
3. [ ] FAS ë™ê¸°í™” ìƒíƒœ API
4. [ ] íˆ¬í‘œ í›„ë³´ ê´€ë¦¬ UI

### P2 (Medium - í’ˆì§ˆ)
1. [ ] Day cutoff ì ìš©
2. [ ] Idempotency (ì¶œê·¼ ë™ê¸°í™”)
3. [ ] E2E í…ŒìŠ¤íŠ¸ ìž‘ì„±

---

## ë¹Œë“œ ìƒíƒœ

| íŒ¨í‚¤ì§€ | ìƒíƒœ | ë¹„ê³  |
|--------|------|------|
| @safetywallet/types | âœ… ë¹Œë“œ ì„±ê³µ | - |
| @safetywallet/api | âœ… ë¹Œë“œ ì„±ê³µ | NestJS |
| @safetywallet/admin-app | âœ… ë¹Œë“œ ì„±ê³µ | Next.js 14 |
| @safetywallet/worker-app | âœ… ë¹Œë“œ ì„±ê³µ | Next.js 14 |

> ë§ˆì§€ë§‰ ë¹Œë“œ: 2026-02-05 (turbo 2.8.3, 27.09s)
